<!doctype html><meta charset="utf-8">
<title>ForgeFinds Diagnostics</title>
<style>
  body{font-family:system-ui;margin:24px;background:#0f1115;color:#e6edf6}
  code{background:#12151d;padding:2px 6px;border-radius:6px}
  .ok{color:#9ef199}.err{color:#ffb4b4}.muted{color:#9aa7b1}
  pre{background:#12151d;padding:12px;border-radius:8px;overflow:auto}
</style>
<h1>Diagnostics</h1>
<ol>
  <li id="step1" class="muted">Fetching <code>/assets/deals.js</code>…</li>
  <li id="step2" class="muted">Fetching <code>/data/deals.json</code>…</li>
  <li id="step3" class="muted">Parsing JSON…</li>
  <li id="step4" class="muted">Rendering sample card…</li>
</ol>
<div id="out"></div>
<script>
(async () => {
  const el1 = document.getElementById('step1');
  const el2 = document.getElementById('step2');
  const el3 = document.getElementById('step3');
  const el4 = document.getElementById('step4');
  const out = document.getElementById('out');
  try{
    const js = await fetch('/assets/deals.js', {cache:'no-store'});
    if(!js.ok) throw new Error(`assets/deals.js HTTP ${js.status}`);
    el1.className='ok'; el1.textContent = 'Loaded /assets/deals.js';

    const r = await fetch('/data/deals.json?cb='+Date.now(), {cache:'no-store'});
    if(!r.ok) throw new Error(`data/deals.json HTTP ${r.status}`);
    el2.className='ok'; el2.textContent = 'Fetched /data/deals.json';

    const txt = await r.text();
    let data;
    try{ data = JSON.parse(txt); }
    catch(e){ throw new Error('JSON parse error: '+e.message+'\n\nFirst 300 chars:\n'+txt.slice(0,300)); }
    el3.className='ok'; el3.textContent = `Parsed JSON (${Array.isArray(data)?data.length:0} items)`;

    // render first item to prove images/markup are fine
    const d = (Array.isArray(data) && data[0]) || {};
    out.innerHTML = '<pre>'+JSON.stringify(d, null, 2)+'</pre>';
    el4.className='ok'; el4.textContent = 'Rendered first item below';
  }catch(err){
    const msg = String(err && err.message || err);
    const pre = document.createElement('pre'); pre.textContent = msg;
    out.innerHTML = '<h3 class="err">Failure</h3>'; out.appendChild(pre);
    if (el1.className!=='ok') { el1.className='err'; }
    else if (el2.className!=='ok') { el2.className='err'; }
    else if (el3.className!=='ok') { el3.className='err'; }
    else { el4.className='err'; }
    console.error('[Diagnostics]', err);
  }
})();
</script>